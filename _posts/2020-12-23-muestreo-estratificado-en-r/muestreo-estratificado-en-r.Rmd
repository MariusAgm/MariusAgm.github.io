---
title: "Muestreo estratificado en R"
description: |
  Un tutorial de cómo hacer muestreo, cuando la población es más compleja.
author:
  - name: Mario A. García-Meza
    url: https://marionomics.com/about
date: 12-23-2020
output:
  distill::distill_article:
    self_contained: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

Hay que admitir que la mayoría de las ocasiones este es el caso: la población no es tan simple como para que un muestreo simple sea la solución. En [este post](https://www.marionomics.com/posts/2020-12-23-tamaos-de-muestra-para-una-encuesta/) hice un tutorial de cómo obtener los tamaños de muestra para una encuesta con una función hecha por nosotros mismos y [aquí](https://www.marionomics.com/posts/2020-12-23-cmo-calcular-el-tamao-de-muestra-en-r/) explico parte de la teoría y cómo obtener las muestras con la función `pwr.t.test()`.

Pero en esta ocasión, vamos a llevar el análisis un paso más allá y preguntarnos que sucede si la población con la que nos encontramos tiene características heterogéneas. Y siendo sinceros, toda población que vale la pena estudiarse es al menos un poco heterogénea.

Recordemos que nuestro objetivo es la _inferencia estadística_, es decir, obtener la misma información que obtendríamos de la población, pero usando un conjunto de datos más pequeño. Sin embargo, supongamos que existen tres tipos distintos de población en nuestra muestra. Estos representan el 50%, 40% y 10% de la población respectivamente. Si nosotros tomaramos una muestra uniforme, de los datos, existe la probabilidad de sobrerepresentar o subrepresentar algún estrato.

```{r stratified-plot}
library("ggplot2")
s = c(rep("A",50),rep("B",40),rep("C",10))
df = as.data.frame(table(s))
p <- ggplot(df,aes(x=s,y=Freq,fill=s)) + geom_bar(stat="identity")+
 geom_text(aes(label=Freq),vjust=1.6) +
 theme(legend.position = "none")
 
p
```

No solamente se trata de la proporción. Los estratos pueden variar en su desviación estándar. Esto hace que el muestreo estratificado proporcione una visión más clara de lo que está pasando al muestreo simple.

Veamos cómo se realiza este muestreo. Consideremos [este ejemplo](https://en.wikipedia.org/wiki/Stratified_sampling), donde se encuentra la siguiente distribución de trabajadores en una compañía

|Tipo de personal | Número |
|--|--|
|Hombre, tiempo completo | 9000|
|Hombre, tiempo parcial | 1800 |
| Mujer, tiempo completo | 900  |
| Mujer, tiempo parcial | 6300 |
|--|--|
| **Total** | 18000 |

Naturalmente, podemos ver que los estratos difieren mucho entre si, y una distribución uniforme nos daría resultados probablemente sesgados.

Usaremos nuevamente la librería `samplingbook`, pero en esta ocasión haremos uso de la función `stratasize()`, usando los datos de este ejemplo. Consideramos para esto que las desviaciones estándar en cada uno de los estratos están dados por el vector `sh`. También estamos considerando un margen de error de 10%.

```{r samplin-strata, echo=TRUE, include=TRUE}
Nh <- c(9000,1800,900,6300)
sh <- c(25,10,40,80)
sum(Nh)
samplingbook::stratasize(0.1, Nh = Nh, Sh = c(5,1,4,.80),
                         level = 0.95, type = 'prop')
```

En este ejemplo, los argumentos `level ` y `type` vienen por default con esos valores. Sólo los estoy incluyendo con fines ilustrativos.

Notamos aquí entonces que de los 18 mil sujetos que tenemos, sólo es necesario obtener información acerca de alrededor de 4 mil para conocerlos, de acuerdo a la información que tenemos disponible.

¿Cuáles son aplicaciones interesantes para lo que usarías esta información?